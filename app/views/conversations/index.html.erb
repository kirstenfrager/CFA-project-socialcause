<%= render 'partials/navbar' %>

<div class="row">
  <div class="col m6 center-align">
    <h2 class="raleway">Mailbox.</h2>
    <div class="ui segment">
      <div class="ui list">
        <% @conversations.each do |conversation| %>
          <% if conversation.sender_id == current_user.id || conversation.recipient_id == current_user.id %>
            <% if conversation.sender_id == current_user.id %>
              <% recipient = User.find(conversation.recipient_id) %>
            <% else %>
              <% recipient = User.find(conversation.sender_id) %>
            <% end %>
            <% first_message = conversation.messages.first %>
            <% if first_message %>
              <%= first_message.body %>
            <% end %>
            <div class="button-space divider-div">
              <%= recipient.first_name %> <%= recipient.last_name %> <br>
              <%= link_to 'Inbox |', conversation_messages_path(conversation)%>
              <%= link_to 'Destroy', conversation, method: :delete, data: { confirm: 'Are you sure?' } %>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>

  <%= link_to 'Start a new conversation with us', new_conversation_path %>


  <% if current_user.admin? %>
    <div class="col m6 center-align">
      <h2 class="raleway">All Users.</h2>
      <div class="ui segment">
        <div class="ui list">
          <% @users.each do |user| %>
            <% if user.id != current_user.id %>
            <div class="button-space divider-div">
              <%= user.first_name %> <%= user.last_name %> <br> <%= link_to "Message me!", conversations_path(sender_id: current_user.id, recipient_id: user.id), method: 'post'%>
            </div>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>
</div>

<div class="right button-space">
  <% if current_user.admin? %>
    <%= link_to 'Back', pages_admin_dashboard_path %>
  <% end %>
</div>
