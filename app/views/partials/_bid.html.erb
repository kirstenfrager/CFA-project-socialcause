<% if user_signed_in? %>
  <% if @photograph.has_auction? %>
    <% if @photograph.auction.ended? %>
      <%= render 'auctions/status' %>
    <% else %>
      <%= form_for [ @photograph,  @photograph.auction, Bid.new], html: { multipart: true } do |f| %>
        <p>
          <% if @photograph.auction.top_bid %>
            <% if @photograph.auction.top_bid.user_id == current_user.id %>
              <strong>
                Current Bid:
              </strong>
                AUD$ <%= @photograph.auction.current_bid %>
            <% else %>
              <strong>
                You were outbid, new current bid:
              </strong>
                AUD$ <%= @photograph.auction.current_bid %>
            <% end %>
            <% else %>
              <strong>
                Minimum Bid is:
              </strong>
                AUD$ <%= @photograph.auction.current_bid %>
          <% end %>
        </p>
        <p>
          <strong>
            Ends at:
          </strong>
          <%= l(@photograph.auction.ends_at, format: :short) %>
        </p>

        <div class="bgimg">
           <div class="middle">
             <p id="patch">Auction ends in:</p>
             <p id="demo"></p>
           </div>
         </div>
         <br>

         <script>
           // Set the date we're counting down to
           var countDownDate = new Date("<%= @photograph.auction.ends_at %>").getTime();
           // Update the count down every 1 second
           var countdownfunction = setInterval(function() {
               // Get todays date and time
               var now = new Date().getTime();
               // Find the distance between now an the count down date
               var distance = countDownDate - now;
               // Time calculations for days, hours, minutes and seconds
               var days = Math.floor(distance / (1000 * 60 * 60 * 24));
               var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
               var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
               var seconds = Math.floor((distance % (1000 * 60)) / 1000);
               // Output the result in an element with id="demo"
               document.getElementById("demo").innerHTML = days + " days " + hours + "h "
               + minutes + "min " + seconds + "s ";
               // If the count down is over, write some text
               if (distance < 0) {
                   clearInterval(countdownfunction);
                   document.getElementById("demo").innerHTML = "EXPIRED";
               }
           }, 1000);
         </script>


           <p>
             <div class="input-field col s12">
               <label for="password">Amount</label>
                <%= f.text_field :value, class: "validate" %>
              </div>
            <%= f.button 'Place Bid', class: "waves-effect waves-light btn"%>
          </p>
      <% end %>
    <% end %>
  <% end %>
<% end %>
